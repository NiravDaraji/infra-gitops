suite: Service basics
templates:
  - templates/service.yaml

tests:
  - it: should render a Service resource
    asserts:
      - isKind:
          of: Service

  - it: should set service type from values.yaml
    asserts:
      - equal:
          path: spec.type
          value: NodePort

  - it: should expose port from values.yaml
    asserts:
      - contains:
          path: spec.ports
          content:
            name: http
            port: 3000
            protocol: TCP
            targetPort: http

  - it: should set targetPort name http and protocol TCP
    asserts:
      - equal:
          path: spec.ports[0].targetPort
          value: "http"
      - equal:
          path: spec.ports[0].protocol
          value: "TCP"

  - it: should allow overriding service type and port
    set:
      service:
        type: LoadBalancer
        port: 9090
        loadBalancerIP: 10.10.10.10
    asserts:
      - equal:
          path: spec.type
          value: LoadBalancer
      - equal:
          path: spec.loadBalancerIP
          value: "10.10.10.10"
      - equal:
          path: spec.ports[0].port
          value: 9090
      - equal:
          path: spec.ports[0].name
          value: http
      - equal:
          path: spec.ports[0].protocol
          value: TCP
      - equal:
          path: spec.ports[0].targetPort
          value: http

